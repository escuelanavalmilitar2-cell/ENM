<!-- registro.html -->
<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro Pre-Facultativo Naval</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    font-family: 'Segoe UI', sans-serif;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    background: url('IMG/1M.jpg') center/cover no-repeat; /* fondo inicial corregido */
    transition: background 0.5s ease;
    padding: 20px;
  }
  .container {
    width: 100%;
    max-width: 500px;
  }
  .form-step {
    background: rgba(255, 255, 255, 0.93);
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.4);
    display: none;
    text-align: center;
    width: 100%;
    animation: fadeIn 0.5s ease-in-out;
  }
  .form-step.active { display: block; }
  @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
  input, select, button {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    font-size: 16px;
    border: 1px solid #bbb;
    border-radius: 8px;
  }
  input:focus, select:focus {
    outline: none;
    border-color: #004080;
    box-shadow: 0 0 5px rgba(0,64,128,0.5);
  }
  select[multiple] { height: 120px; }
  button {
    background: #004080;
    border: none;
    color: white;
    cursor: pointer;
    border-radius: 8px;
    font-weight: bold;
    transition: background 0.3s;
  }
  button:hover { background: #003366; }
  label {
    font-weight: bold;
    display: block;
    margin-top: 10px;
    text-align: left;
    color: #222;
  }
  small {
    display: block;
    text-align: left;
    color: #555;
    margin-bottom: 5px;
    font-size: 13px;
  }
  #matriculaDisplay {
    margin-top: 20px;
    font-weight: bold;
    font-size: 22px;
    color: #b22222;
    background: rgba(255,255,255,0.8);
    padding: 12px;
    border-radius: 10px;
  }
  #mensajeCarga {
    margin-top: 20px;
    font-size: 15px;
    display: none;
    background: rgba(255,255,255,0.8);
    padding: 12px;
    border-radius: 10px;
    text-align: center;
  }
  #mensajeCarga a { color: #004080; text-decoration: underline; font-weight: bold; }
  #errorMatricula {
    margin-top: 15px;
    display: none;
    background: rgba(255, 100, 100, 0.2);
    color: #b22222;
    padding: 10px;
    border-radius: 8px;
    font-weight: bold;
  }
  @media(max-width: 500px){
    .form-step { padding: 20px; }
    input, select, button { font-size: 14px; padding: 10px; }
    #matriculaDisplay { font-size: 20px; padding: 10px; }
  }
</style>
</head>
<body>
<div class="container">
  <form id="formulario">

    <!-- Paso 1 -->
    <div class="form-step active">
      <h2>üìù Paso 1: Datos Personales</h2>
      <label for="apellidoPaterno">Apellido Paterno</label>
      <input type="text" id="apellidoPaterno" placeholder="Ej: P√©rez" required>
      <small>Ingrese su apellido paterno tal como figura en su documento de identidad.</small>

      <label for="apellidoMaterno">Apellido Materno</label>
      <input type="text" id="apellidoMaterno" placeholder="Ej: L√≥pez" required>
      <small>Ingrese su apellido materno completo.</small>

      <label for="nombres">Nombres</label>
      <input type="text" id="nombres" placeholder="Ej: Juan Carlos" required>
      <small>Escriba todos sus nombres seg√∫n su C.I.</small>

      <button type="button" onclick="nextStep(1)">‚û°Ô∏è Siguiente</button>
    </div>

    <!-- Paso 2 -->
    <div class="form-step">
      <h2>üìÑ Paso 2: Documento</h2>
      <label for="ci">C√©dula de Identidad</label>
      <input type="text" id="ci" placeholder="Ej: 1234567" required>
      <small>Digite su n√∫mero de carnet de identidad sin guiones ni espacios.</small>

      <label for="fechaNacimiento">Fecha de Nacimiento</label>
      <input type="date" id="fechaNacimiento" required>
      <small>Seleccione su fecha exacta de nacimiento.</small>

      <label for="edad">Edad</label>
      <input type="number" id="edad" placeholder="Ej: 18" required>
      <small>Ingrese su edad en n√∫meros enteros.</small>

      <button type="button" onclick="nextStep(2)">‚û°Ô∏è Siguiente</button>
    </div>

    <!-- Paso 3 -->
    <div class="form-step">
      <h2>üìç Paso 3: Lugar de Origen y Residencia</h2>

      <label for="lugarNacimiento">Lugar de Nacimiento</label>
      <select id="lugarNacimiento" required>
        <option value="">Seleccione...</option>
        <option>La Paz</option><option>Cochabamba</option><option>Santa Cruz</option>
        <option>Oruro</option><option>Potos√≠</option><option>Tarija</option>
        <option>Chuquisaca</option><option>Beni</option><option>Pando</option>
      </select>
      <small>Elija el departamento donde naci√≥.</small>

      <label for="lugarResidencia">Lugar de Residencia</label>
      <select id="lugarResidencia" required>
        <option value="">Seleccione...</option>
        <option>La Paz</option><option>Cochabamba</option><option>Santa Cruz</option>
        <option>Oruro</option><option>Potos√≠</option><option>Tarija</option>
        <option>Chuquisaca</option><option>Beni</option><option>Pando</option>
      </select>
      <small>Seleccione el departamento donde vive actualmente.</small>

      <button type="button" onclick="nextStep(3)">‚û°Ô∏è Siguiente</button>
    </div>

    <!-- Paso 4 -->
    <div class="form-step">
      <h2>üìû Paso 4: Contacto y Matr√≠cula</h2>
      <label for="celular">N√∫mero de Celular</label>
      <input type="text" id="celular" placeholder="Ej: 78945612" required>
      <small>Ingrese un n√∫mero v√°lido para recibir notificaciones.</small>

      <button type="button" id="btnGenerar" onclick="generarMatricula()">üéñÔ∏è Generar Matr√≠cula</button>
      <div id="matriculaDisplay"></div>

      <!-- Enlace a Google Forms -->
      <div id="mensajeCarga">
        <p>Despu√©s de generar tu matr√≠cula, debes subir un solo archivo PDF que contenga tu <b>Boucher de pago</b> y tu <b>C√©dula de Identidad</b>.</p>
        <a href="https://forms.gle/oNsa8L1ZFPCcQNxH7" target="_blank">üìÑ Subir Documentos</a>
        <p>
  Una vez que hayas subido el PDF en el enlace proporcionado, regresa a esta p√°gina y completa la carga de tus datos. 
  <b>Nota:</b> Si al volver tus datos no aparecen, ingr√©salos nuevamente y s√∫belos.  
  <b>Importante:</b> Posterior a la verificaci√≥n de la inscripci√≥n y los documentos adjuntos, se te agregar√° a un grupo de WhatsApp dentro de 24 horas. En caso de no ser agregado o si surge cualquier inconveniente durante la inscripci√≥n, comun√≠cate con Admisi√≥n.
</p>

      <!-- Mensaje de error -->
      <div id="errorMatricula"></div>

      <button type="button" id="btnSubir" onclick="subirDatos()">üì§ Enviar Datos</button>
    </div>
  </form>
</div>

<input type="hidden" id="matricula">

<script>
// ‚úÖ Correcci√≥n: ahora apunta a la carpeta correcta "IMG2" y extensi√≥n ".jpg"
const fondos = ["IMG/1M.jpg","IMG/2M.jpg","IMG/3M.jpg","IMG/4M.jpg"];
let fondoIndex = 0;

function nextStep(current){
  const steps = document.querySelectorAll('.form-step');
  const currentStep = steps[current-1];

  // Validaci√≥n
  const inputs = currentStep.querySelectorAll('input, select');
  let allFilled = true;
  inputs.forEach(input=>{
    if(input.value===""||input.value===null) allFilled=false;
  });

  if(!allFilled){
    alert('‚ö†Ô∏è Completa todos los campos antes de continuar.');
    return;
  }

  // Avanzar paso
  currentStep.classList.remove('active');
  steps[current].classList.add('active');

  // Cambiar fondo
  fondoIndex = (fondoIndex +1) % fondos.length;
  document.body.style.backgroundImage = `url('${fondos[fondoIndex]}')`;
  document.body.style.backgroundSize = "cover"; 
}

function generarMatricula(){
  const apellido = document.getElementById('apellidoPaterno').value.trim();
  const ci = document.getElementById('ci').value.trim();
  if(apellido && ci.length>=4){
    const matricula = apellido.charAt(0).toUpperCase() + '-' + ci.slice(-4);
    document.getElementById('matriculaDisplay').innerText = 'üéñÔ∏è Tu Matr√≠cula es: ' + matricula;
    document.getElementById('matricula').value = matricula;

    // Mostrar mensaje con enlace
    document.getElementById('mensajeCarga').style.display='block';
    document.getElementById('errorMatricula').style.display='none';
  } else {
    alert('‚ö†Ô∏è Completa Apellido Paterno y C.I. correctamente.');
  }
}

function subirDatos(){
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwqoBNKe5YL_Egc6CQ4nCrarLzbTawKS8YB3oHNux-7_oEgCi3SSveiR8nVKI7PQhx59g/exec"; 
  const btnSubir = document.getElementById('btnSubir');
  const errorDiv = document.getElementById('errorMatricula');

  btnSubir.disabled = true;
  btnSubir.innerText = "‚è≥ Enviando datos...";

  const fechaActual = new Date().toISOString().slice(0,10);
  const formData = new FormData();
  formData.append('apellidoPaterno', document.getElementById('apellidoPaterno').value);
  formData.append('apellidoMaterno', document.getElementById('apellidoMaterno').value);
  formData.append('nombres', document.getElementById('nombres').value);
  formData.append('ci', document.getElementById('ci').value);
  formData.append('fechaNacimiento', document.getElementById('fechaNacimiento').value);
  formData.append('edad', document.getElementById('edad').value);
  formData.append('lugarNacimiento', document.getElementById('lugarNacimiento').value);
  formData.append('lugarResidencia', document.getElementById('lugarResidencia').value);
  formData.append('celular', document.getElementById('celular').value);
  formData.append('matricula', document.getElementById('matricula').value);
  formData.append('fechaInscripcion', fechaActual);

  fetch(SCRIPT_URL, { method: 'POST', body: formData })
  .then(response => response.json())
  .then(data => {
    if(data.status==="OK"){
      errorDiv.style.display='none';
      alert('‚úÖ Datos enviados correctamente');
    } else {
      errorDiv.innerText = data.message;
      errorDiv.style.display='block';
      btnSubir.disabled = false;
      btnSubir.innerText = "üì§ Enviar Datos";
    }
  })
  .catch(err=>{
    errorDiv.innerText = '‚ùå Error al enviar los datos';
    errorDiv.style.display='block';
    console.error(err);
    btnSubir.disabled = false;
    btnSubir.innerText = "üì§ Enviar Datos";
  });
}
</script>
</body>
</html>


